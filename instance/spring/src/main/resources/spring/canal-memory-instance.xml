<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:aop="http://www.springframework.org/schema/aop" xmlns:lang="http://www.springframework.org/schema/lang"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd
           http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-2.0.xsd
           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd"
	default-autowire="byName" default-init-method="start"
	default-destroy-method="stop">

	<bean id="retl"
		class="com.alibaba.otter.canal.instance.spring.CanalInstanceWithSpring">
		<property name="destination" value="${canal.instance.memory.destination}" />
		<property name="eventParser">
			<ref local="mysqlParser" />
		</property>
		<property name="eventSink">
			<ref local="eventSink" />
		</property>
		<property name="eventStore">
			<ref local="memoryEventStoreWithBuffer" />
		</property>
		<property name="haController">
			<ref local="heartBeatHAController" />
		</property>
		<property name="logPositionManager">
			<ref local="memoryLogPositionManager" />
		</property>
		<property name="metaManager">
			<ref local="memoryMetaManager" />
		</property>
	</bean>



	<bean id="memoryMetaManager" class="com.alibaba.otter.canal.meta.MemoryMetaManager" />

	<bean id="memoryEventStoreWithBuffer"
		class="com.alibaba.otter.canal.store.memory.MemoryEventStoreWithBuffer" />

	<bean id="heartBeatHAController" class="com.alibaba.otter.canal.parse.ha.HeartBeatHAController">
		<property name="replicationController">
			<ref local="mysqlParser" />
		</property>
		<property name="detectingRetryTimes"
			value="${canal.instance.memory.ha.detecting.retry.times}" />
	</bean>

	<bean id="eventSink"
		class="com.alibaba.otter.canal.sink.mysql.MysqlEventSink">
		<property name="eventStore">
			<ref local="memoryEventStoreWithBuffer" />
		</property>
	</bean>

	<bean id="memoryLogPositionManager"
		class="com.alibaba.otter.canal.parse.index.MemoryLogPositionManager" />
		
	<bean id="alarmHandler" class="com.alibaba.otter.canal.common.alarm.LogAlarmHandler" />

	<bean id="mysqlParser"
		class="com.alibaba.otter.canal.parse.inbound.mysql.MysqlEventParser">
		<property name="slaveId" value="${canal.instance.memory.slave.id}" />

		<property name="heartBeatCallback">
			<ref local="heartBeatHAController" />
		</property>

		<property name="logPositionManager">
			<ref local="memoryLogPositionManager" />
		</property>

		<property name="masterInfo">
			<ref local="masterInfo" />
		</property>
		<property name="masterPosition">
			<ref local="masterPosition" />
		</property>

		<property name="standbyInfo">
			<ref local="standbyInfo" />
		</property>
		<property name="standbyPosition">
			<ref local="standbyPosition" />
		</property>

		<property name="detectingSQL" value="${canal.instance.memory.detecting.sql}" />
		<property name="eventSink">
			<ref local="eventSink" />
		</property>
		
		<property name="alarmHandler">
			<ref local="alarmHandler" />
		</property>
		<property name="destination" value="${canal.instance.memory.destination}"/>
	</bean>

	<bean id="masterInfo"
		class="com.alibaba.otter.canal.parse.support.AuthenticationInfo">
		<property name="address">
			<bean class="java.net.InetSocketAddress">
				<constructor-arg value="${canal.instance.memory.master.hostname}" />
				<constructor-arg value="${canal.instance.memory.master.port}" />
			</bean>
		</property>
		<property name="username" value="${canal.instance.memory.master.username}" />
		<property name="password" value="${canal.instance.memory.master.password}" />
		<property name="defaultDatabaseName"
			value="${canal.instance.memory.master.defaultDatabaseName}" />
	</bean>
	<bean id="standbyInfo"
		class="com.alibaba.otter.canal.parse.support.AuthenticationInfo">
		<property name="address">
			<bean class="java.net.InetSocketAddress">
				<constructor-arg value="${canal.instance.memory.standby.hostname}" />
				<constructor-arg value="${canal.instance.memory.standby.port}" />
			</bean>
		</property>
		<property name="username" value="${canal.instance.memory.standby.username}" />
		<property name="password" value="${canal.instance.memory.standby.password}" />
		<property name="defaultDatabaseName"
			value="${canal.instance.memory.standby.defaultDatabaseName}" />
	</bean>

	<bean id="masterPosition" class="com.alibaba.otter.canal.protocol.position.EntryPosition">
		<property name="journalName" value="${canal.instance.memory.master.journal.name}" />
		<property name="position" value="${canal.instance.memory.master.position}" />
		<property name="timestamp" value="${canal.instance.memory.master.timestamp}" />
		<property name="included"
			value="${canal.instance.memory.master.position.included}" />
	</bean>
	<bean id="standbyPosition" class="com.alibaba.otter.canal.protocol.position.EntryPosition">
		<property name="journalName"
			value="${canal.instance.memory.standby.journal.name}" />
		<property name="position" value="${canal.instance.memory.standby.position}" />
		<property name="timestamp" value="${canal.instance.memory.standby.timestamp}" />
		<property name="included"
			value="${canal.instance.memory.standby.position.included}" />
	</bean>
</beans>